<!DOCTYPE html>
  <%- include("./partials/header.ejs") %>

  <main>
    <div class="container">
        <div class="row pt-5" >

            <!--Grid column-->
            <div class="col-md-12">
    
                  <div class="container">
    
                    <!--Section: Contact v.2-->
                    <section class="section">
    
                      <!--Section heading-->
                      <h2 class="font-weight-bold text-center h1 pt-5">Login</h2>
    
                      <div class="row pt-3 flex-center">
    
                        <!--Grid column-->
                        <div class="">
                          <form action="/login">
    
                              <!--Grid column-->
                              <div class="col">
                                <div class="form-outline">
                                  <input type="email" name="email" id="email"  class="form-control" required>
                                  <label for="email" class="">Email</label>
                                  <div class="email error"></div>
              
                                </div>
                              </div>
                              <!--Grid column-->
    
                              <!--Grid column-->
                              <div class="col">
                                <div class="form-outline">
                                    <input type="password" name="password" id="password"  class="form-control" required>
                                    <label for="password" class="">Password</label>
                                    <div class="password error"></div>
              
                                </div>
                              </div>    
                            
                            <div class="text-center text-md-left my-4">
                              <button type="submit" class="btn btn-warning">Login</button>
                            </div>
                          </form>
                        </div>
    
                      </div>
    
                    </section>

              </div>
    
            </div>
    </div>
  </main>    
</body>


<script>
    const form = document.querySelector('form');
    const emailError = document.querySelector('.email.error');
    const passwordError = document.querySelector('.password.error');
  
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
  
      // reset errors
      emailError.textContent = '';
      passwordError.textContent = '';
  
      // get values
      const email = form.email.value;
      const password = form.password.value;
  
      try {
        const res = await fetch('/login', { 
          method: 'POST', 
          body: JSON.stringify({ email, password }),
          headers: {'Content-Type': 'application/json'}
        });
        const data = await res.json();
        console.log(data);
        if (data.errors) {
          emailError.textContent = data.errors.email;
          passwordError.textContent = data.errors.password;
        }
        if (data.user) {
            console.log('fjnW;DIJNwapisuncW')
          location.assign('/');
        }
  
      }
      catch (err) {
        console.log(err);
      }
    });
  </script>
</html>